<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>WGNS Lobby Live</title>
  <style>
    :root{
      --bg:#0b1220; --panel:rgba(255,255,255,.92); --panel-strong:#fff;
      --border:rgba(255,255,255,.14); --text:#0f172a; --muted:rgba(15,23,42,.65);
      --radius:18px; --shadow:0 18px 48px rgba(0,0,0,.25);
      --brand:#ef4444;
    }
    html,body{height:100%}
    body{
      margin:0; min-height:100vh;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";
      color:var(--text);
      background:
        radial-gradient(1200px 600px at 15% 10%, rgba(239,68,68,.22), transparent 60%),
        radial-gradient(900px 520px at 85% 20%, rgba(249,115,22,.16), transparent 55%),
        radial-gradient(1100px 700px at 50% 100%, rgba(59,130,246,.10), transparent 60%),
        var(--bg);
      display:grid; place-items:center;
      padding:clamp(14px,3vw,28px); box-sizing:border-box;
    }
    .wg-app{
      width:min(1200px,100%);
      height:min(720px,100%);
      max-height:calc(100vh - clamp(28px, 6vw, 56px));
      background:linear-gradient(180deg,var(--panel),rgba(255,255,255,.86));
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow:hidden;
      display:flex; flex-direction:column;
      backdrop-filter:blur(10px);
    }
    .wg-header{
      display:flex; align-items:center; gap:14px;
      padding:14px 16px;
      border-bottom:1px solid rgba(15,23,42,.08);
      background:linear-gradient(180deg,var(--panel-strong),rgba(255,255,255,.88));
      flex:0 0 auto;
    }
    .wg-brand{display:flex; flex-direction:column; gap:2px; min-width:0}
    .wg-brand .title{font-weight:950; letter-spacing:-.02em; font-size:1.02rem; line-height:1.1}
    .wg-brand .sub{font-size:.85rem; color:var(--muted)}
    .wg-spacer{margin-left:auto}
    .wg-badge{
      display:inline-flex; align-items:center; gap:8px;
      padding:7px 10px; border-radius:999px;
      border:1px solid rgba(15,23,42,.10);
      background:rgba(255,255,255,.75);
      font-weight:900;
    }
    .dot{width:9px; height:9px; border-radius:99px; background:#9ca3af}
    .dot.live{background:#22c55e}
    .wg-toggle{
      display:inline-flex;
      background:rgba(15,23,42,.06);
      border:1px solid rgba(15,23,42,.10);
      border-radius:999px;
      overflow:hidden;
      margin-left:10px;
    }
    .wg-toggle button{
      background:transparent; border:none;
      padding:9px 14px; cursor:pointer;
      color:rgba(15,23,42,.65);
      font-weight:950;
    }
    .wg-toggle button[aria-pressed="true"]{
      background:rgba(255,255,255,.9);
      color:var(--text);
      box-shadow:0 6px 16px rgba(0,0,0,.10);
    }
    .wg-body{padding:16px; flex:1 1 auto; min-height:0; display:flex}
    .wg-video{position:relative; width:100%; height:100%; background:#000; border-radius:16px; overflow:hidden}
    .wg-video iframe{position:absolute; inset:0; width:100%; height:100%; border:none}
    .wg-audio-card{width:100%; height:100%; display:grid; place-items:center}
    .wg-audio{
      width:min(720px,100%);
      border-radius:18px;
      border:1px solid rgba(15,23,42,.10);
      background:rgba(255,255,255,.88);
      box-shadow:0 12px 28px rgba(0,0,0,.10);
      padding:22px;
      display:grid; gap:14px;
    }
    .wg-play{
      width:72px; height:72px;
      border-radius:50%;
      border:1px solid rgba(15,23,42,.14);
      background:#fff;
      cursor:pointer;
      display:grid; place-items:center;
      font-size:26px;
    }
    .wg-volume{width:320px}
  </style>
</head>
<body>
  <main class="wg-app">
    <header class="wg-header">
      <div class="wg-brand">
        <div class="title" id="wg-mode-label">Loading…</div>
        <div class="sub">Automatically switches to video when LIVE</div>
      </div>
      <div class="wg-spacer"></div>
      <div class="wg-badge">
        <span class="dot" id="wg-dot"></span>
        <span id="wg-live-text">Checking…</span>
      </div>
      <nav class="wg-toggle">
        <button id="btn-listen">Listen</button>
        <button id="btn-watch">Watch</button>
      </nav>
    </header>
    <section class="wg-body" id="wg-content"></section>
  </main>

<script>
(() => {
  const config = {
    channelId: 'UCaR9jZW5TJNrSg7w70czrsw',
    audioSrc: 'https://ice5.securenetsystems.net/WGNSM',
    youtubeApiKey: 'AIzaSyB1seR1hQDpeJtkxml0R8lyitpqldAGzA0',
    pollMs: 45000
  };

  const btnListen = document.getElementById('btn-listen');
  const btnWatch  = document.getElementById('btn-watch');
  const content   = document.getElementById('wg-content');
  const modeLabel = document.getElementById('wg-mode-label');
  const dot = document.getElementById('wg-dot');
  const liveText = document.getElementById('wg-live-text');

  let mode = 'listen';
  let audioEl = null;
  let liveVideoId = null;

  const embedSrc = (vid) =>
    'https://www.youtube-nocookie.com/embed/' + (vid || 'live_stream?channel=' + config.channelId) +
    '?autoplay=1&mute=1&playsinline=1';

  function setBadge(live){
    dot.classList.toggle('live', live);
    liveText.textContent = live ? 'LIVE' : 'Off Air';
  }

  function setMode(m){
    mode = m;
    modeLabel.textContent = m === 'watch' ? 'Watch Live' : 'Listen Live';
    btnListen.setAttribute('aria-pressed', m==='listen');
    btnWatch.setAttribute('aria-pressed', m==='watch');
    if(m==='watch') renderWatch(); else renderListen();
  }

  function renderListen(){
    content.innerHTML = '';
    const card = document.createElement('div');
    card.className = 'wg-audio-card';
    card.innerHTML = '<div class="wg-audio"><button class="wg-play" id="wg-play">▶</button><input id="wg-volume" class="wg-volume" type="range" min="0" max="100" value="80"></div>';
    audioEl = audioEl || new Audio(config.audioSrc);
    audioEl.volume = 0.8;
    card.appendChild(audioEl);
    content.appendChild(card);

    document.getElementById('wg-play').onclick = async () => {
      if(audioEl.paused){ await audioEl.play(); document.getElementById('wg-play').textContent='❚❚'; }
      else{ audioEl.pause(); document.getElementById('wg-play').textContent='▶'; }
    };
    document.getElementById('wg-volume').oninput = e => audioEl.volume = e.target.value/100;
  }

  function renderWatch(){
    if(audioEl) audioEl.pause();
    content.innerHTML = '<div class="wg-video"><iframe allow="autoplay; encrypted-media" allowfullscreen src="'+embedSrc(liveVideoId)+'"></iframe></div>';
  }

  async function pollLive(){
    const url = 'https://www.googleapis.com/youtube/v3/search?part=id&channelId='+config.channelId+'&eventType=live&type=video&maxResults=1&key='+config.youtubeApiKey;
    try{
      const res = await fetch(url, {cache:'no-store'});
      const json = await res.json();
      const live = json.items && json.items.length;
      liveVideoId = live ? json.items[0].id.videoId : null;
      setBadge(live);
      if(live && mode!=='watch') setMode('watch');
      if(!live && mode!=='listen') setMode('listen');
    }catch(e){}
  }

  btnListen.onclick = ()=>setMode('listen');
  btnWatch.onclick  = ()=>setMode('watch');

  setMode('listen');
  pollLive();
  setInterval(pollLive, config.pollMs);
})();
</script>
</body>
</html>
