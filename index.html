<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>WGNS Lobby Live</title>
  <style>
    :root{
      --bg:#0b1220;
      --panel:rgba(255,255,255,.92);
      --border:rgba(255,255,255,.14);
      --text:#0f172a;
      --muted:rgba(15,23,42,.65);
      --radius:18px;
      --shadow:0 18px 48px rgba(0,0,0,.25);
    }
    html,body{height:100%}
    body{
      margin:0; min-height:100vh;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";
      color:var(--text);
      background:
        radial-gradient(1200px 600px at 15% 10%, rgba(239,68,68,.22), transparent 60%),
        radial-gradient(900px 520px at 85% 20%, rgba(249,115,22,.16), transparent 55%),
        radial-gradient(1100px 700px at 50% 100%, rgba(59,130,246,.10), transparent 60%),
        var(--bg);
      display:grid; place-items:center;
      padding:clamp(14px,3vw,28px); box-sizing:border-box;
    }
    .wg-app{
      width:min(1200px,100%);
      height:min(720px,100%);
      max-height:calc(100vh - clamp(28px, 6vw, 56px));
      background:linear-gradient(180deg,var(--panel),rgba(255,255,255,.86));
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow:hidden;
      display:flex; flex-direction:column;
      backdrop-filter:blur(10px);
    }
    .wg-header{
      display:flex; align-items:center; gap:14px;
      padding:14px 16px;
      border-bottom:1px solid rgba(15,23,42,.08);
      background:linear-gradient(180deg,rgba(255,255,255,.95),rgba(255,255,255,.88));
      flex:0 0 auto;
    }
    .wg-brand{display:flex; flex-direction:column; gap:2px; min-width:0}
    .wg-brand .title{font-weight:950; letter-spacing:-.02em; font-size:1.02rem; line-height:1.1}
    .wg-brand .sub{font-size:.85rem; color:var(--muted)}
    .wg-spacer{margin-left:auto}
    .wg-badge{
      display:inline-flex; align-items:center; gap:8px;
      padding:7px 10px; border-radius:999px;
      border:1px solid rgba(15,23,42,.10);
      background:rgba(255,255,255,.75);
      font-weight:900;
      color:rgba(15,23,42,.85);
    }
    .dot{width:9px; height:9px; border-radius:99px; background:#9ca3af}
    .dot.live{background:#22c55e}
    .wg-body{padding:16px; flex:1 1 auto; min-height:0; display:flex}

    /* Video */
    .wg-video{position:relative; width:100%; height:100%; background:#000; border-radius:16px; overflow:hidden}
    .wg-video iframe{position:absolute; inset:0; width:100%; height:100%; border:none}

    /* Off-air slideshow */
    .wg-slideshow{
      position:relative;
      width:100%; height:100%;
      border-radius:16px;
      overflow:hidden;
      background:rgba(15,23,42,.06);
      border:1px solid rgba(15,23,42,.10);
      isolation:isolate;
    }
    .wg-slide{
      position:absolute; inset:0;
      display:flex; align-items:center; justify-content:center;
      padding:clamp(16px,2.5vw,28px);
      opacity:0;
      animation-name: wgFade;
      animation-timing-function: ease-in-out;
      animation-iteration-count: infinite;
      animation-duration: calc(var(--slide-seconds) * 4s);
    }
    .wg-slide::before{
      content:"";
      position:absolute; inset:0;
      background:
        radial-gradient(900px 540px at 50% 45%, rgba(255,255,255,.22), transparent 60%),
        radial-gradient(1200px 700px at 20% 20%, rgba(239,68,68,.12), transparent 60%),
        radial-gradient(1000px 700px at 80% 70%, rgba(59,130,246,.10), transparent 60%);
      pointer-events:none;
      mix-blend-mode: soft-light;
    }
    .wg-slide img{
      width:min(100%, 980px);
      height:auto;
      max-height:100%;
      object-fit:contain;
      filter: drop-shadow(0 24px 40px rgba(0,0,0,.25));
      transform: scale(1);
      animation: wgPulse calc(var(--slide-seconds) * 1s) ease-in-out infinite;
    }

    .wg-slide:nth-child(1){animation-delay: calc(var(--slide-seconds) * 0s);}
    .wg-slide:nth-child(2){animation-delay: calc(var(--slide-seconds) * 1s);}
    .wg-slide:nth-child(3){animation-delay: calc(var(--slide-seconds) * 2s);}
    .wg-slide:nth-child(4){animation-delay: calc(var(--slide-seconds) * 3s);}

    @keyframes wgFade{
      0%   {opacity:0}
      10%  {opacity:1}
      75%  {opacity:1}
      90%  {opacity:0}
      100% {opacity:0}
    }
    @keyframes wgPulse{
      0%   {transform: scale(1)}
      50%  {transform: scale(1.03)}
      100% {transform: scale(1)}
    }

    @media (prefers-reduced-motion: reduce){
      .wg-slide, .wg-slide img{animation:none !important}
      .wg-slide{opacity:1; position:relative}
    }
    @media (max-width:560px){
      .wg-badge{display:none}
    }
  </style>
</head>
<body>
  <main class="wg-app">
    <header class="wg-header">
      <div class="wg-brand">
        <div class="title" id="wg-mode-label">Checking live status…</div>
        <div class="sub" id="wg-sub">Off-air slideshow plays until we go LIVE.</div>
      </div>
      <div class="wg-spacer"></div>
      <div class="wg-badge">
        <span class="dot" id="wg-dot"></span>
        <span id="wg-live-text">Checking…</span>
      </div>
    </header>
    <section class="wg-body" id="wg-content"></section>
  </main>

<script>
(() => {
  const config = {
    channelId: 'UCaR9jZW5TJNrSg7w70czrsw',
    youtubeApiKey: 'AIzaSyB1seR1hQDpeJtkxml0R8lyitpqldAGzA0',
    pollMs: 45000,

    // Seconds each slide stays on-screen (recommend 8–12)
    slideSeconds: 10,

    slides: [
      { src: 'WGNS.png', alt: 'WGNS' },
      { src: 'BGTV.png', alt: 'Big G TV' },
      { src: 'PTS.png',  alt: 'Primetime Sports' },
      { src: 'RWX.png',  alt: 'Rutherford Weather' },
    ]
  };

  const content   = document.getElementById('wg-content');
  const modeLabel = document.getElementById('wg-mode-label');
  const sub       = document.getElementById('wg-sub');
  const dot       = document.getElementById('wg-dot');
  const liveText  = document.getElementById('wg-live-text');

  let mode = 'offair'; // offair | watch
  let liveVideoId = null;

  function setBadge(live){
    dot.classList.toggle('live', !!live);
    liveText.textContent = live ? 'LIVE' : 'Off Air';
  }

  function videoEmbedSrc(vid){
    const origin = (location.origin && location.origin !== 'null') ? '&origin=' + encodeURIComponent(location.origin) : '';
    if (vid){
      return 'https://www.youtube-nocookie.com/embed/' + encodeURIComponent(vid) + '?autoplay=1&mute=1&playsinline=1' + origin;
    }
    return 'https://www.youtube-nocookie.com/embed/live_stream?channel=' + encodeURIComponent(config.channelId) + '&autoplay=1&mute=1&playsinline=1' + origin;
  }

  function renderWatch(){
    mode = 'watch';
    modeLabel.textContent = 'Watch Live';
    sub.textContent = 'You are watching the live stream.';
    content.innerHTML = '<div class="wg-video"><iframe allow="autoplay; encrypted-media; picture-in-picture" allowfullscreen src="'+videoEmbedSrc(liveVideoId)+'"></iframe></div>';
  }

  function renderOffAir(){
    mode = 'offair';
    modeLabel.textContent = 'We’re Off Air (for now)';
    sub.textContent = 'This display will switch to video automatically when we go LIVE.';
    const slidesHtml = config.slides.map(s => (
      '<div class="wg-slide"><img src="'+s.src+'" alt="'+(s.alt||'')+'" /></div>'
    )).join('');
    content.innerHTML = '<div class="wg-slideshow" style="--slide-seconds:'+config.slideSeconds+'">'+slidesHtml+'</div>';
  }

  async function pollLive(){
    const url = 'https://www.googleapis.com/youtube/v3/search?part=id&channelId='
      + encodeURIComponent(config.channelId)
      + '&eventType=live&type=video&maxResults=1&key='
      + encodeURIComponent(config.youtubeApiKey);

    try{
      const res = await fetch(url, {cache:'no-store'});
      if(!res.ok) throw new Error('HTTP '+res.status);
      const json = await res.json();
      const isLive = !!(json.items && json.items.length);
      liveVideoId = isLive ? (json.items[0].id && json.items[0].id.videoId) : null;

      setBadge(isLive);

      if (isLive && mode !== 'watch') renderWatch();
      if (!isLive && mode !== 'offair') renderOffAir();
    }catch(e){
      // If the check fails, keep current mode and badge conservative.
      setBadge(false);
    }
  }

  // Preload slides
  config.slides.forEach(s => { const i = new Image(); i.src = s.src; });

  renderOffAir();
  pollLive();
  setInterval(pollLive, config.pollMs);
})();
</script>
</body>
</html>
